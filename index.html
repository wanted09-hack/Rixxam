<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Ayrix ‚Äì Live Sync Player</title>

  <link rel="manifest" href="manifest.json">
<script>
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("service-worker.js");
  }
</script>
    <link rel="icon" type="image/png" sizes="192x192" href="icons/ayrix-icon-192.png">
  <link rel="apple-touch-icon" href="icons/ayrix-icon-192.png">
  <meta name="theme-color" content="#05000b">


  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
        * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 16px;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #ff4da6 0, transparent 55%),
                  radial-gradient(circle at bottom, #7b5dff 0, transparent 55%),
                  #050515;
      min-height: 100vh;
      display: flex;
      align-items: center;       /* center vertically */
      justify-content: center;   /* center horizontally */
      color: #f8f2ff;
    }

    .app {
      width: 90%;
max-width: 600px;
      
margin: 0 auto;
      background: rgba(8, 6, 24, 0.96);
      border-radius: 24px;
      padding: 20px 18px;
      box-shadow:
        0 18px 45px rgba(0, 0, 0, 0.7),
        0 0 35px rgba(255, 77, 166, 0.55),
        0 0 60px rgba(123, 93, 255, 0.45);
      backdrop-filter: blur(18px);
    }

    h1 {
      margin: 0 0 6px;
      font-size: 1.5rem;
      text-align: center;
      letter-spacing: 0.03em;
    }

    .subtitle {
      text-align: center;
      font-size: 0.8rem;
      margin-bottom: 14px;
      opacity: 0.8;
    }

    #hostToggle {
      display: block;
      width: 100%;
      padding: 12px;
      border-radius: 999px;
      border: none;
      font-size: 0.9rem;
      margin-bottom: 10px;
      cursor: pointer;
      background: linear-gradient(90deg, #252047, #342a63);
      color: #f6ebff;
      transition: background 0.2s ease, transform 0.15s ease, box-shadow 0.15s ease;
      box-shadow: 0 0 0 rgba(0,0,0,0);
    }

    #hostToggle.host {
      background: linear-gradient(90deg, #ff4fa0, #ff7edb);
      color: #fff;
      box-shadow: 0 0 18px rgba(255, 79, 160, 0.7);
    }

    #hostToggle:active {
      transform: scale(0.98);
    }

    audio {
      width: 100%;
      margin: 12px 0 10px;
      filter: drop-shadow(0 0 10px rgba(0, 0, 0, 0.4));
    }

    #status {
      font-size: 0.78rem;
      text-align: center;
      margin-bottom: 8px;
      opacity: 0.9;
    }

    #songs {
      max-height: 390px;
      overflow-y: auto;
      margin-top: 10px;
      padding-right: 2px;
    }

    .song-button {
      width: 100%;
      padding: 10px 12px;
      margin-bottom: 8px;
      border-radius: 14px;
      border: none;
      text-align: left;
      font-size: 0.86rem;
      cursor: pointer;
      background: rgba(23, 18, 52, 0.95);
      color: #f7e9ff;
      transition: background 0.2s ease, transform 0.15s ease, box-shadow 0.15s ease;
      box-shadow: 0 0 0 rgba(0,0,0,0);
    }

    .song-button:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.5);
    }

    .song-button.playing {
      background: linear-gradient(90deg, #ff4fa0, #7f5dff);
      color: #fff;
      box-shadow:
        0 0 14px rgba(255, 79, 160, 0.7),
        0 0 22px rgba(127, 93, 255, 0.6);
      transform: translateY(-1px) scale(1.01);
    }

    .song-button.playing::before {
      content: "‚óè ";
      color: #ffe9ff;
    }
    /* === New Ayrix Splash (Overlay + No Glitch) === */

#ayrix-splash {
  position: fixed;
  inset: 0;
  z-index: 9999;
  display: flex;
  justify-content: center;
  align-items: center;
  background: radial-gradient(circle at top, #15001f, #050008 60%);
  animation: ayrixSplashIn 0.5s ease-out forwards;
}

#ayrix-splash.hide {
  animation: ayrixSplashOut 0.6s ease-in forwards;
}

.ayrix-splash-inner {
  text-align: center;
  padding: 24px;
}

.ayrix-splash-logo {
  width: 90px;
  height: 90px;
  border-radius: 24px;
  box-shadow: 0 0 35px rgba(255, 80, 200, 0.6);
}

.ayrix-splash-title {
  margin-top: 12px;
  font-size: 1.3rem;
  font-weight: 700;
  letter-spacing: 0.15em;
  text-transform: uppercase;
}

.ayrix-splash-subtitle {
  margin-top: 5px;
  font-size: 0.7rem;
  opacity: 0.85;
  letter-spacing: 0.13em;
  text-transform: uppercase;
}

/* Fade-in animation */
@keyframes ayrixSplashIn {
  0% { opacity: 0; transform: scale(0.96); }
  100% { opacity: 1; transform: scale(1); }
}

/* Fade-out animation */
@keyframes ayrixSplashOut {
  0% { opacity: 1; transform: scale(1) translateY(0); }
  100% { opacity: 0; transform: scale(0.96) translateY(-18px); visibility: hidden; }
}

/* App stays hidden until splash finishes */
.app {
  opacity: 0;
  transform: translateY(8px);
  transition: opacity 0.45s ease, transform 0.45s ease;
}

.app.app-ready {
  opacity: 1;
  transform: translateY(0);
}



   #playerBar {
     padding: 12px 18px;
     margin-top: 10px;
     border-radius: 18px;
     background: rgba(255, 255, 255, 0.06);
     backdrop-filter: blur(12px);
   }

   .time-row {
     display: flex;
     justify-content: space-between;
     font-size: 11px;
     opacity: 0.75;
     margin-bottom: 6px;
   }

   #seekBar {
     width: 100%;
     -webkit-appearance: none;
     appearance: none;
     height: 4px;
     border-radius: 999px;
     background: rgba(255, 255, 255, 0.22);
     outline: none;
     margin-bottom: 12px;
   }

   #seekBar::-webkit-slider-thumb {
     width: 14px;
     height: 14px;
     border-radius: 50%;
     background: #ffffff;
     -webkit-appearance: none;
   }

   .player-controls {
     display: flex;
     justify-content: center;
     gap: 22px;
   }

   .player-controls button {
     background: linear-gradient(135deg, #ffb347, #ff7a18);
     color: #fff;
     border: none;
     padding: 10px 18px;
     border-radius: 14px;
     font-size: 20px;
     box-shadow: 0 0 15px rgba(255, 122, 24, 0.4);
     transition: 0.15s ease;
   }

   .player-controls button:active {
     transform: scale(0.9);
     box-shadow: 0 0 6px rgba(0, 0, 0, 0.4);
   }

</style>
  
</head>

<body>
  <!-- Ayrix opening splash -->
  <div id="ayrix-splash">
    <div class="ayrix-splash-inner">
      <div class="ayrix-splash-logo-wrap">
        <img src="icons/ayrix-icon-192.png" alt="Ayrix logo" class="ayrix-splash-logo">
      </div>
      <div class="ayrix-splash-title">AYRIX</div>
      <div class="ayrix-splash-subtitle">Stay synced, stay close ü§ç</div>
    </div>
  </div>
  
  <div class="app">
    ...
    <h1>Ayrix ‚Äì Live Sync Player</h1>
    

    
    <div class="subtitle">Ayrix by Aman ‚Ä¢ Stay synced, stay close ü§ç</div>

    

    <button id="hostToggle">Become host</button>
    <div id="status">You are a listener. Wait for host to play a song.</div>

    <div id="playerBar">
  <!-- Time row -->
  <div class="time-row">
    <span id="currentTime">0:00</span>
    <span id="totalTime">0:00</span>
  </div>

  <!-- Progress line -->
  <input
    type="range"
    id="seekBar"
    min="0"
    max="100"
    value="0"
    step="0.1"
  />

  <!-- Buttons below -->
  <div class="player-controls">
    <button id="prevBtn">‚è™</button>
    <button id="playPauseBtn">‚ñ∂</button>
    <button id="nextBtn">‚è©</button>
  </div>

  <!-- Hidden real audio -->
  <audio id="player"></audio>

</div>


    <div id="songs">Loading songs‚Ä¶</div>
  </div>

  <script>
  const splash = document.getElementById("ayrix-splash");
  const app = document.querySelector(".app");

  if (splash && app) {
    app.classList.remove("app-ready");

    setTimeout(() => {
      splash.classList.add("hide");
    }, 1600); // 1.6s splash

    setTimeout(() => {
      splash.remove();
      app.classList.add("app-ready");
    }, 2300); // splash out + app fade-in
  }
</script>


  <script type="module">
    // ====== GOOGLE DRIVE STREAM CONFIG ======
    const GOOGLE_API_KEY = "AIzaSyA06vHg4uelFoqLIs-dVBF_trQ7qBtR7TU";

    // ---------- SONG LIST (tumhare links) ----------
    // ------------ SONG LIST (loaded from Ayrix JSON API) ---------
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxSf4pGRfrEH3Y8nN9-mqGy6OT2z5BjXsWUlHFlha25lpnsQtR4xjSXnU7MDv1HLcZW6g/exec";
let SONGS = [];

// ================= CUSTOM PLAYER CONTROLS =================

const audioPlayer = document.getElementById("player");
const prevBtn = document.getElementById("prevBtn");
const playPauseBtn = document.getElementById("playPauseBtn");
const nextBtn = document.getElementById("nextBtn");
const seekBar = document.getElementById("seekBar");
const currentTimeEl = document.getElementById("currentTime");
const totalTimeEl = document.getElementById("totalTime");

let currentSongIndex = 0;

// Load song by index
function loadSong(index) {
    const song = SONGS[index];
    if (!song) return;
    const url = toStreamUrl(song.url);
    audioPlayer.src = url;
    audioPlayer.currentTime = 0;
    audioPlayer.play();
    highlightPlaying(url);
    sendState();
}

// Play/Pause button
playPauseBtn.addEventListener("click", () => {
    if (audioPlayer.paused) {
        audioPlayer.play();
        playPauseBtn.innerText = "‚è∏";
    } else {
        audioPlayer.pause();
        playPauseBtn.innerText = "‚ñ∂";
    }
});

// Previous button
prevBtn.addEventListener("click", () => {
    currentSongIndex = (currentSongIndex - 1 + SONGS.length) % SONGS.length;
    loadSong(currentSongIndex);
});

// Next button
nextBtn.addEventListener("click", () => {
    currentSongIndex = (currentSongIndex + 1) % SONGS.length;
    loadSong(currentSongIndex);
});

// Update seek bar + time
audioPlayer.addEventListener("timeupdate", () => {
    const progress = (audioPlayer.currentTime / audioPlayer.duration) * 100;
    seekBar.value = progress || 0;

    currentTimeEl.innerText = formatTime(audioPlayer.currentTime);
    totalTimeEl.innerText = formatTime(audioPlayer.duration);
});

// Seek manually
seekBar.addEventListener("input", () => {
    const time = (seekBar.value / 100) * audioPlayer.duration;
    audioPlayer.currentTime = time;
});

// Format time
function formatTime(sec) {
    if (!sec) return "0:00";
    const m = Math.floor(sec / 60);
    const s = Math.floor(sec % 60).toString().padStart(2, "0");
    return `${m}:${s}`;
}

    // Drive link -> streamable URL
    function toStreamUrl(driveUrl) {
      const match = driveUrl.match(/id=([^&]+)/);
      const fileId = match ? match[1] : driveUrl.trim();
      return `https://www.googleapis.com/drive/v3/files/${fileId}?alt=media&key=${GOOGLE_API_KEY}`;
    }

    // ---------- FIREBASE ----------
    import {initializeApp} from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import {
      getDatabase,
      ref,
      onValue,
      update
    } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCWnQ02Wy3rM-gG8yVwfSJchRsO7aDrTcU",
      authDomain: "ritaxaman.firebaseapp.com",
      databaseURL: "https://ritaxaman-default-rtdb.firebaseio.com",
      projectId: "ritaxaman",
      storageBucket: "ritaxaman.firebasestorage.app",
      messagingSenderId: "559873885969",
      appId: "1:559873885969:web:e7a7b4fe3a3fc5b420aeb0",
      measurementId: "G-53Z6W1XTJS"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const sessionRef = ref(db, "sessions/ritaAman");

    // ---------- UI ELEMENTS ----------
    const audio = document.getElementById("player");
    const hostToggle = document.getElementById("hostToggle");
    const statusEl = document.getElementById("status");
    const songsContainer = document.getElementById("songs");

    let isHost = false;

    // ---------- HOST TOGGLE ----------
    hostToggle.addEventListener("click", () => {
      isHost = !isHost;
      if (isHost) {
        hostToggle.classList.add("host");
        hostToggle.textContent = "You are host ‚úÖ";
        statusEl.textContent =
          "You are host. Whatever you play will sync to connected devices.";
        sendState();
      } else {
        hostToggle.classList.remove("host");
        hostToggle.textContent = "Become host";
        statusEl.textContent =
          "You are a listener. Wait for host to play a song.";
      }
    });
// ---------- LOAD SONGS FROM AYRIX JSON API ----------
async function loadSongsFromApi() {
  try {
    if (songsContainer) {
      songsContainer.textContent = "Loading songs...";
    }

    const res = await fetch(SCRIPT_URL);
    const data = await res.json();

    if (!data || !Array.isArray(data.songs) || data.songs.length === 0) {
      if (songsContainer) {
        songsContainer.textContent = "No songs found in Drive folder.";
      }
      SONGS = [];
      return;
    }

    // API se aaye songs set karo
    SONGS = data.songs;

    if (songsContainer) {
      songsContainer.textContent = "";
    }

    // buttons banao + pehla song select
    buildSongButtons();
    loadSong(0);
  } catch (err) {
    console.error("Error loading songs from API:", err);
    if (songsContainer) {
      songsContainer.textContent = "Error loading songs. Please try again later.";
    }
  }
}

    // ---------- SONG BUTTONS FROM SONGS ARRAY ----------
    function buildSongButtons() {
      if (!SONGS.length) {
        songsContainer.textContent = "No songs configured.";
        return;
      }
      songsContainer.innerHTML = "";
      SONGS.forEach((song, index) => {
        const btn = document.createElement("button");
        btn.className = "song-button";
        btn.textContent = (index + 1) + ". " + song.name;
        btn.dataset.url = song.url; // original drive url

        btn.addEventListener("click", () => {
          if (!isHost) {
            alert("Only host can select songs. Tap 'Become host' on your phone.");
            return;
          }
          const streamUrl = toStreamUrl(song.url);
          playAsHost(streamUrl);
          highlightPlaying(streamUrl);
        });

        songsContainer.appendChild(btn);
      });
    }

    function highlightPlaying(url) {
      const buttons = songsContainer.querySelectorAll(".song-button");
      buttons.forEach((b) => {
        const streamForButton = toStreamUrl(b.dataset.url);
        if (streamForButton === url) {
          b.classList.add("playing");
        } else {
          b.classList.remove("playing");
        }
      });
    }

    // ---------- HOST: SEND STATE ----------
    function sendState() {
      if (!isHost) return;
      update(sessionRef, {
        songUrl: audio.src || "",
        isPlaying: !audio.paused,
        position: audio.currentTime || 0,
        updatedAt: Date.now()
      }).catch((e) => console.error("sendState error:", e));
    }

    async function playAsHost(url) {
      if (!isHost) return;
      audio.src = url;
      audio.currentTime = 0;
      try {
        await audio.play();
      } catch (e) {
        console.error("Playback error:", e);
      }
      sendState();
    }

    audio.addEventListener("play", () => sendState());
    audio.addEventListener("pause", () => sendState());
    audio.addEventListener("seeked", () => sendState());
    audio.addEventListener("ended", () => sendState());

    // ---------- LISTENER: RECEIVE STATE ----------
    onValue(sessionRef, async (snapshot) => {
      const data = snapshot.val();
      if (!data) return;

      const {songUrl, isPlaying, position} = data;

      if (isHost) return; // host ignore kare

      if (songUrl && audio.src !== songUrl) {
        audio.src = songUrl;
        highlightPlaying(songUrl);
      }

      if (Math.abs(audio.currentTime - position) > 1) {
        audio.currentTime = position;
      }

      if (isPlaying && audio.paused) {
        audio.play().catch(() => { });
      } else if (!isPlaying && !audio.paused) {
        audio.pause();
      }

      statusEl.textContent = "Listening with host‚Ä¶ üéß";
    });

    // ----------- START -----------
loadSongsFromApi();

  </script>
</body>

</html> 
